<!DOCTYPE html>
<html>
    <head>
        <title>Scrims</title>
        <script type="text/javascript" src="silencio/js/dat.gui.js"></script>
        <script type="text/javascript" src="silencio/js/jquery.js"></script>
        <script type="text/javascript" src="silencio/js/Silencio.js"></script>
        <script type="text/javascript" src="silencio/js/ChordSpace.js"></script>
        <script type="text/javascript" src="silencio/js/sprintf.js"></script>
        <script type="text/javascript" src="silencio/js/three.js"></script>
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <style>
                ::-webkit-scrollbar
            {
                width:10px;
            }
            ::-webkit-scrollbar-track-piece
            {
                background-coor:transparent;
            }
        </style>
       <script>
            try {
                var nw_window = nwgui.Window.get();
                nw_window.on('close', function() {
                    console.log('Closing down...');
                this.close(true);
                //process.exit(0);
                });
            } catch (err) {
                console.log(err.message);
            }
        </script>
    </head>
    <body style="background:black;">
         <div id = 'webgl_cell' class='canvas' style="width:98vw;height:98vh;"/>
        <table id = 'statistics' style="table-layout:fixed;position:absolute;left:1vw;color:#eee;top:1vw;font-family:Monaco, sans-serif;font-size:8pt">
            <col width=300px>
            <col width=150px>
            <th style="color:gold;text-align:left">Scrims (PNaCl version for Chrome), by Michael Gogins.
            Wait for "Csound: Ready."; click "Play/Stop"; adjust "Master effects" group "gk_MasterOutput_level" slider.</p></td><td style="color:gold;text-align:right;"</th>
            <!-- Copyright (C) 2016 by Michael Gogins -->
            <tr>
                <td>Time: </td><td id="Time_cell" style="color:SkyBlue;text-align:right;"></td>
            </tr>
            <tr>
                <td>Subset: </td><td id="Subset_cell" style="color:SkyBlue;text-align:right;"></td>
            </tr>
            <tr>
                <td>Point: </td><td id="Point_cell" style="color:SkyBlue;text-align:right;"></td>
            </tr>
            <tr>
                <td>X: </td><td id="X_cell" style="color:SkyBlue;text-align:right;"></td>
            </tr>
            <tr>
                <td>Y: </td><td id="Y_cell" style="color:SkyBlue;text-align:right;"></td>
            </tr>
             <tr>
                <td>Chord: </td><td id="Chord_cell" style="color:SkyBlue;text-align:right;"></td>
            </tr>
            <tr>
                <td>Notes: </td><td id="Notes_cell" style="color:SkyBlue;text-align:right;"></td>
            </tr>
           <tr>
            <!-- or: http://stackoverflow.com/questions/35509360/how-to-make-the-content-of-the-following-table-cell-scrollable -->
                <td colspan=2><textarea id="console" style="width:100%;color:SkyBlue;background-color:transparent;border:none;text-align:left;font-size:10px;height:200px;overflow:auto;"></textarea></td>
            </tr>
        </table>
    <textarea class="code" id="orc" hidden rows=24 cols=80>
opcode hertz2midinn, i, i
ihertz xin
print ihertz
; m = 12*log2(fm/440 Hz) + 69
ilog2 = log(2)
imidinn = 12 * (log(ihertz / 440) / ilog2) + 69
print imidinn
xout imidinn
endop

; Each Csound instrument uses global variables
; and function tables declared in the global area of the orchestra
; just above the instrument definition itself. A naming pattern is
; used to avoid name collisions and keep everything straight.

gaSendM,gaSendL,gaSendR init 0
gi_FM_Clang_sine ftgen 0,0,4096,10,1 ;A SINE WAVE. USED BY THE LFOs.
gi_FM_Clang_detuning ftgen 0,0,128,21,1,1 ; random array used for fixing unique detune values for each note
gi_FM_Clang_DryMap ftgen 0,0,4096,7,1,2048,1,2048,0 ; dry mixer control mapping
gi_FM_Clang_WetMap ftgen 0,0,4096,7,0,2048,1,2048,1 ; wet mixer control mapping
gaSendL,gaSendR init 0 ; initialise variable used for sending audio between instruments
gi_FM_Clang_Imp ftgen 0,0,4097,9,0.5,1,0 ; shape for the hammer inpulse
gi_FM_Clang_stereo ftgen 0,0,256,21,1,1 ; random array used for fixing unique stereo values for each note
gi_FM_Clang_detune ftgen 0,0,256,21,1,1 ; random array used for fixing unique detune values for each note
gi_FM_Clang_scale ftgen 0,0,128,-7,-1,128,1

instr FM_Clang_controls ; Read in widgets
iporttime = 0.05
gk_FM_Clang_mod chnget "mod"
gk_FM_Clang_mod port gk_FM_Clang_mod,iporttime
gk_FM_Clang_NdxVel chnget "NdxVel"
gk_FM_Clang_Dur chnget "Dur"
gk_FM_Clang_FiltFund chnget "FiltFund"
gk_FM_Clang_NdxCurve chnget "NdxCurve"
gk_FM_Clang_LPF chnget "LPF"
gk_FM_Clang_ModDep chnget "ModDep"
gk_FM_Clang_ModRte chnget "ModRte"
gk_FM_Clang_ModRteKyb chnget "ModRteKyb"
gk_FM_Clang_ModMix chnget "ModMix"
gk_FM_Clang_Sustain chnget "Sustain"
gk_FM_Clang_CarKyb chnget "CarKyb"
gk_FM_Clang_StWidth chnget "StWidth"
gk_FM_Clang_StWidth init 0.01
gk_FM_Clang_StMix chnget "StMix"
gk_FM_Clang_DryWet chnget "RvbDryWet"
gk_FM_Clang_Dry table gk_FM_Clang_DryWet,gi_FM_Clang_DryMap,1 ; map dry/wet control
gk_FM_Clang_Wet table gk_FM_Clang_DryWet,gi_FM_Clang_WetMap,1 ;
gk_FM_Clang_RvbSize chnget "RvbSize"
gk_FM_Clang_Detune chnget "Detune"
gk_FM_Clang_DtnMix chnget "DtnMix"
gk_FM_Clang_Amp chnget "Amp"
gk_FM_Clang_level chnget "gk_FM_Clang_level"
gk_FM_Clang_Amp port gk_FM_Clang_Amp,iporttime
gk_FM_Clang_AttTim chnget "AttTim"
gk_FM_Clang_AttVel chnget "AttVel"
gk_FM_Clang_NseAmp chnget "NseAmp"
gk_FM_Clang_NseBW chnget "NseBW"
gk_FM_Clang_NseFllw chnget "NseFllw"
endin

gi_Droner_overlap init .1
gk_Droner_distort_factor init 0.4
gk_Droner_first_harmonic init 0.4
gk_Droner_slider1 init .05
gk_Droner_slider2 init .1
gk_Droner_slider3 init .04
gk_Droner_slider4 init .2
gk_Droner_slider5 init .02
gk_Droner_level init 0
gi_Droner_sine ftgen 0, 0, 65536, 10, 1, 0, .02
instr Droner
insno = p1
itime = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p7
ipan = p6
idepth = p8
iheight = p9
ipcs = p10
ihomogeneity = p11
k1 init .5
k2 init .05
k3 init .1
k4 init .2
k5 init .1
k6 init .05
k7 init .1
k8 init 0
k9 init 0
k10 init 0
k3 = gk_Droner_slider1
k4 = gk_Droner_slider2
k5 = gk_Droner_slider3
k6 = gk_Droner_slider4
k7 = gk_Droner_slider5
kwaveform init 0
iamp = ampdb(ivelocity)
iattack = gi_Droner_overlap
idecay = gi_Droner_overlap
isustain = p3
p3 = iattack + isustain + idecay
aenvelope transegr 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
if kwaveform == 0 then
asignal poscil3 1, ihertz, gi_Droner_sine
endif
if kwaveform == 1 then
asignal vco2 1, ihertz, 8 ; integrated saw
endif
if kwaveform == 2 then
asignal vco2 1, ihertz, 12 ; triangle
endif
asignal chebyshevpoly asignal, 0, k1, k2, k3, k4, k5, k6, k7, k8, k9, k10
asignal = asignal * aenvelope * 10
aleft, aright pan2 asignal, ipan
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
kgain = ampdb(gk_Droner_level)
aleft = adamping * aleft * kgain
aright = adamping * aright * kgain
; Each instrument sends its audio to a global audio output bus,
; where effects can be applied.
chnmix aleft, "out_left"
chnmix aright, "out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

opcode FM_Clang_veloc, i, iii
; *p->r = *p->ilo + csound->curip->m_veloc*(*p->ihi - *p->ilo) * dv127;
ivel, ilow, ihigh xin
xout ilow + ivel * (ihigh - ilow) * 0.007874
endop

instr FM_Clang ; Sound producing instrument. Triggered by MIDI notes or score notes.
insno = p1
itime = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p7
ipan = p6
idepth = p8
iheight = p9
ipcs = p10
ihomogeneity = p11
icps = cpsmidinn(ikey)
inum = ikey
iamplitude = ampdb(ivelocity)
; icps cpsmidi
; inum notnum
iKybdScl table inum,gi_FM_Clang_scale ; Keyboard scaling value. Note '0' maps to a value of -1, note 64 maps to a value of zero and note 127 maps to a value of 1.
; Amplitude Envelope
idur = i(gk_FM_Clang_Dur)
iAmpCurve = -8
iRelTim = (i(gk_FM_Clang_Sustain)==1?idur:0.1)
;iAttVel veloc i(gk_FM_Clang_AttVel)*0.05,0
iAttVel FM_Clang_veloc ivelocity, i(gk_FM_Clang_AttVel)*0.05,0
iAttTim = iAttVel + i(gk_FM_Clang_AttTim)
if iAttTim==0 then
aAEnv transegr 1,idur,iAmpCurve,0, iRelTim,iAmpCurve,0
else
aAEnv transegr 0,iAttTim,iAmpCurve, 1,idur,iAmpCurve,0, iRelTim,iAmpCurve,0
endif
; Key velocity to amplitude
;iAVel veloc 0,0.1
iAVel FM_Clang_veloc ivelocity, 0, 0.1
; FM index
iNdx veloc 0,i(gk_FM_Clang_NdxVel) ; Key velocity to FM index
iNdx FM_Clang_veloc ivelocity, 0,i(gk_FM_Clang_NdxVel) ; Key velocity to FM index
kIEnv transeg iNdx*octave(-iKybdScl*4),idur,-i(gk_FM_Clang_NdxCurve),0 ; Index envelope. Amplitude influenced by 'Index' widget control and keyboard scaling (index reduced for higher notes, increased for lower notes)
; Carrier frequency keyboard scaling
icar = 1 * octave(iKybdScl*i(gk_FM_Clang_CarKyb))
; Carrier ratio modulation
iModRte table inum,gi_FM_Clang_scale
iModRte = octave(iModRte*i(gk_FM_Clang_ModRteKyb))
kDepEnv transeg 1,idur,-4,0
amod lfo gk_FM_Clang_ModDep*0.1*kDepEnv, gk_FM_Clang_ModRte * iModRte, 0
; Noise bandpass filter cutoff as it respond to the 'Carrier Follow' switch
kcf = gk_FM_Clang_NseFllw==1?icps*gk_FM_Clang_mod:icps
; Noise amplitude keyboard following
kNseAmp = octave(iKybdScl*-4)*gk_FM_Clang_NseAmp
; Main FM algorithm
if gk_FM_Clang_NseAmp>0 then ; If noise amplitude is greater than zero...
aNse gauss kNseAmp ; ... generate some gaussian noise
aNse butbp aNse,kcf,kcf*gk_FM_Clang_NseBW ; bandpass filter the noise
aNse butbp aNse,kcf,kcf*gk_FM_Clang_NseBW ; and again
else
aNse = 0 ; Otherwise no noise signal!
endif
idetune table inum,gi_FM_Clang_detune ; Read a detuning value from a random table
asig foscil iAVel, icps*cent(-gk_FM_Clang_Detune*idetune), icar +aNse, gk_FM_Clang_mod, kIEnv, gi_FM_Clang_sine ; FM pair
aModSig foscil iAVel, icps*cent(-gk_FM_Clang_Detune*idetune), icar+amod+aNse, gk_FM_Clang_mod, kIEnv, gi_FM_Clang_sine ; FM pair with modulation
asig = asig + (aModSig * gk_FM_Clang_ModMix) ; Mix the two FM pairs.
; Auxilliary FM algorithm (used for detuning)
if gk_FM_Clang_DtnMix>0&&gk_FM_Clang_Detune>0 then
if gk_FM_Clang_NseAmp>0 then
aNse gauss kNseAmp
aNse butbp aNse,kcf,kcf*gk_FM_Clang_NseBW
aNse butbp aNse,kcf,kcf*gk_FM_Clang_NseBW
else
aNse = 0
endif
idetune table inum+128,gi_FM_Clang_detune ; Read a detuning value from a random table
asig2 foscil iAVel, icps*cent(gk_FM_Clang_Detune*idetune), icar +aNse, gk_FM_Clang_mod, kIEnv, gi_FM_Clang_sine ; Detuning applied to fundemental
aModSig2 foscil iAVel, icps*cent(gk_FM_Clang_Detune*idetune), icar+amod+aNse, gk_FM_Clang_mod, kIEnv, gi_FM_Clang_sine
asig2 = asig2 + (aModSig2 * gk_FM_Clang_ModMix)
asig = asig + asig2*gk_FM_Clang_DtnMix
endif
; Filter Fundemental
if i(gk_FM_Clang_FiltFund)==1 then ; If filter fundemental switch is active
asig butbr asig,icps*icar,icps*icar*0.3 ; Filter out fundemental
asig butbr asig,icps*icar,icps*icar*0.3 ; and again to make sure it is all gone
endif
; Lowpass Filter
if i(gk_FM_Clang_LPF)<32 then ; If lowpass filter is less than maximum...
kCF limit icps*gk_FM_Clang_LPF,20,20000 ; ...create the cutoff value in CPS based on fundemental and LPF ratio control. Limit to prevent out of range values.
asig clfilt asig,kCF,0,2 ; Butterworth lowpass filter
endif
; Amplitude Envelope
kgain = ampdb(gk_FM_Clang_level)
asig = asig * aAEnv * gk_FM_Clang_Amp * kgain; Apply amplitude envelope
; Stereo Effect
iDlyTimL table inum,gi_FM_Clang_stereo ; Read a delay time value from a random table based on note played
iDlyTimR table inum+128,gi_FM_Clang_stereo ; Read a different delay time value from a random table based on note played
if gk_FM_Clang_StWidth>0&&gk_FM_Clang_StMix>0 then ; If 'width' is above zero and 'mix' is above zero...
aL vdelay asig, iDlyTimL*gk_FM_Clang_StWidth*1000, 0.2*1000 ; ...left channel delay
aR vdelay asig, iDlyTimR*gk_FM_Clang_StWidth*1000, 0.2*1000 ; right channel delay
aL ntrpol asig, aL, gk_FM_Clang_StMix ; Mix delayed and dry signal
aR ntrpol asig, aR, gk_FM_Clang_StMix ;
aleft = aL;*gk_FM_Clang_Dry
aright = aR;*gk_FM_Clang_Dry
gaSendL = gaSendL + aL ; Send to reverb
gaSendR = gaSendR + aR
else
aleft = asig;*gk_FM_Clang_Dry
aright = asig;*gk_FM_Clang_Dry
gaSendL = gaSendL + asig ; Send to reverb
gaSendR = gaSendR + asig
endif
aleft = aleft * ampdb(ivelocity)
aright = aleft * ampdb(ivelocity)
chnmix aleft, "out_left"
chnmix aright, "out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gk_Harpsichord_level init 0
gk_HarpsichordPan init .5
gi_Harptable ftgen 0, 0, 65536, 7, -1, 1024, 1, 1024, -1
instr Harpsichord
//////////////////////////////////////////////
// Original by James Kelley.
// Adapted by Michael Gogins.
//////////////////////////////////////////////
insno = p1
itime = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p7
ipan = p6
idepth = p8
iheight = p9
ipcs = p10
ihomogeneity = p11
iattack = .005
isustain = p3
irelease = .3
p3 = iattack + isustain + irelease
iHz = cpsmidinn(ikey)
kHz = k(iHz)
iamplitude = ampdb(ivelocity)
aenvelope 	 transeg 1.0, 20.0, -10.0, 0.05
apluck 	 pluck 1, kHz, iHz, 0, 1
aharp 	 poscil 1, kHz, gi_Harptable
aharp2 	 balance apluck, aharp
asignal			 = (apluck + aharp2) * iamplitude * aenvelope * 10
adeclick linsegr 0, iattack, 1, isustain, 1, irelease, 0
kgain = ampdb(gk_Harpsichord_level)
asignal = asignal * adeclick * kgain
aoutleft, aoutright pan2 asignal, ipan
chnmix aoutleft, "out_left"
chnmix aoutright, "out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gi_Sweeper_overlap init .1
gk_Sweeper_britel init 0
gk_Sweeper_briteh init 2.9
gk_Sweeper_britels init .2 / 3
gk_Sweeper_britehs init 2.5 / 2
gk_Sweeper_level init 0
gi_Sweeper_sine ftgen 0, 0, 65536, 10, 1
gi_Sweeper_octfn ftgen 0, 0, 65536, -19, 1, 0.5, 270, 0.5
instr Sweeper
insno = p1
itime = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p7
ipan = p6
idepth = p8
iheight = p9
ipcs = p10
ihomogeneity = p11
iamp = ampdb(ivelocity)
iattack = gi_Sweeper_overlap
idecay = gi_Sweeper_overlap
isustain = p3
p3 = iattack + isustain + idecay
aenvelope transegr 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
icps = ihertz
kamp expseg 0.001,0.02,0.2,p3-0.01,0.001
ktonemoddep jspline 0.01,0.05,0.012
ktonemodrte jspline 6,0.1,0.2
ktone poscil3 ktonemoddep, ktonemodrte, gi_Sweeper_sine
kbrite rspline gk_Sweeper_britel, gk_Sweeper_briteh, gk_Sweeper_britels, gk_Sweeper_britehs
ibasfreq init icps
ioctcnt init 3
iphs init 0
a1 hsboscil 1, ktone, kbrite, ibasfreq, gi_Sweeper_sine, gi_Sweeper_octfn, ioctcnt, iphs
a1 = a1 * aenvelope
amod poscil3 0.25, ibasfreq*(1/3), gi_Sweeper_sine
arm = a1*amod
kmix expseg 0.001, 0.01, rnd(1), rnd(3)+0.3, 0.001
kmix=.25
a1 ntrpol a1, arm, kmix
;a1 pareq a1/10, 400, 15, .707
;a1 tone a1, 500
kpanrte jspline 5, 0.05, 0.1
kpandep jspline 0.9, 0.2, 0.4
kpan poscil3 kpandep, kpanrte, gi_Sweeper_sine
a1,a2 pan2 a1, kpan
a1 delay a1, rnd(0.1)
a2 delay a2, rnd(0.11)
aenv linsegr 1, 1, 0
aenv = aenvelope
aleft = a1*aenv*.02
aright = a2*aenv*.02
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
kgain = ampdb(gk_Sweeper_level)
aleft = adamping * aleft * kgain
aright = adamping * aright * kgain
chnmix aleft, "out_left"
chnmix aright, "out_right"
; printks "gk_Sweeper_level: %f kgain: %f aleft: %f\n", 0.5, gk_Sweeper_level, kgain, k(aleft)
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gi_Buzzer_overlap init .1
gk_Buzzer_harmonics init 2
gk_Buzzer_level init 0
gk_Buzzer_distort_factor init 0.4
gk_Buzzer_first_harmonic init 0.4
gi_Buzzer_sine ftgen 0, 0, 65536, 10, 1
instr Buzzer
insno = p1
itime = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p7
ipan = p6
idepth = p8
iheight = p9
ipcs = p10
ihomogeneity = p11
iamp = ampdb(ivelocity) * 4
iattack = gi_Buzzer_overlap
idecay = gi_Buzzer_overlap
isustain = p3
p3 = iattack + isustain + idecay
aenvelope transegr 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
asignal buzz aenvelope, ihertz, gk_Buzzer_harmonics, gi_Buzzer_sine
asignal = asignal * 3
aleft, aright pan2 asignal, ipan
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
kgain = ampdb(gk_Buzzer_level)
aleft = adamping * aleft * kgain
aright = adamping * aright * kgain
chnmix aleft, "out_left"
chnmix aright, "out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

; All control channels come into this always-on instrument so that
; the channel need be read only once per kperiod for greater efficiency.

instr Controls
insno = p1
itime = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p7
ipan = p6
idepth = p8
iheight = p9
ipcs = p10
ihomogeneity = p11
gk_Droner_slider1 chnget "gk_Droner_slider1"
gk_Droner_slider2 chnget "gk_Droner_slider2"
gk_Droner_slider3 chnget "gk_Droner_slider3"
gk_Droner_slider4 chnget "gk_Droner_slider4"
gk_Droner_slider5 chnget "gk_Droner_slider5"
gk_Droner_level chnget "gk_Droner_level"
gk_Buzzer_harmonics chnget "gk_Buzzer_harmonics"
gk_Buzzer_level chnget "gk_Buzzer_level"
gk_Sweeper_level chnget "gk_Sweeper_level"
gk_Harpsichord_level chnget "gk_Harpsichord_level"
gk_Reverb_Feedback chnget "gk_Reverb_Feedback"
gk_MasterOutput_level chnget "gk_MasterOutput_level"
prints "instr %4d t %12.4f d %12.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gk_FM_Clang_preset init 1
instr FM_Clang_preset
gk_FM_Clang_preset chnget "gk_FM_Clang_preset"
ktrig changed gk_FM_Clang_preset
#define SET_PRESET(N'Amp'AttTim'AttVel'Dur'Sustain'mod'NdxVel'NdxCurve'CarKyb'DtnMix'Detune'LPF'FiltFund'NseAmp'NseBW'NseFllw'ModMix'ModDep'ModRte'ModRteKyb'StMix'StWidth'RvbDryWet'RvbSize)
#
if i(gk_FM_Clang_preset)==$N then
printks2 "setting preset %d\n", $N
chnset $Amp ,"Amp"
chnset $AttTim ,"AttTim"
chnset $AttVel ,"AttVel"
chnset $Dur ,"Dur"
chnset $Sustain ,"Sustain"
chnset $mod ,"mod"
chnset $NdxVel ,"NdxVel"
chnset $NdxCurve ,"NdxCurve"
chnset $CarKyb ,"CarKyb"
chnset $DtnMix ,"DtnMix"
chnset $Detune ,"Detune"
chnset $LPF ,"LPF"
chnset $FiltFund ,"FiltFund"
chnset $NseAmp ,"NseAmp"
chnset $NseBW ,"NseBW"
chnset $NseFllw ,"NseFllw"
chnset $ModMix ,"ModMix"
chnset $ModDep ,"ModDep"
chnset $ModRte ,"ModRte"
chnset $ModRteKyb,"ModRteKyb"
chnset $StMix ,"StMix"
chnset $StWidth ,"StWidth"
chnset $RvbDryWet,"RvbDryWet"
chnset $RvbSize ,"RvbSize"
endif
#
if ktrig==1 then
reinit SEND_PRESET
endif
SEND_PRESET:
; N'Amp'AttTim'AttVel'Dur'Sustain'mod 'NdxVel'NdxCurve'CarKyb'DtnMix'Detune'LPF'FiltFund'NseAmp'NseBW'NseFllw'ModMix'ModDep'ModRte'ModRteKyb'StMix'StWidth'RvbDryWet'RvbSize)
$SET_PRESET(1'0.5'0 '0 '12 '1 '2.29'1 '16 '0 '1 '1.5 '16 '1 '1000 '0.001'0 '1 '0.1 '3 '0 '0.5 '0.01 '0.3 '0.55 )
$SET_PRESET(2'0.8'0 '0 '1.7'1 '5.04'0.55 '100 '0 '0 '0 '3.8'0 '0 '0.001'0 '0 '0.1 '3 '0 '0.5 '0.01 '0.1 '0.55 )
$SET_PRESET(3'0.5'0.1 '0.5 '3.8'1 '1.00'2 '28 '0 '1 '15 '16 '0 '500 '0.0077'1 '1 '0.1 '3 '0 '0.5 '0.01 '0.3 '0.55 )
$SET_PRESET(4'0.5'0 '0.006 '24 '1 '3.19'1 '15 '0 '0.47 '2.5 '16 '1 '0 '0.001'0 '1 '0.1 '0.33 '1.7 '0.5 '0.01 '0.3 '0.55 )
$SET_PRESET(5'0.8'0 '1 '6.6'0 '1.12'1 '13 '-2.68 '1 '25 '3.8'0 '0 '0.001'0 '0 '0.1 '3 '0 '1 '0.02 '0.172 '0.21 )
$SET_PRESET(6'3.25'0.1 '1 '1.28'0 '2.55'0.55 '35 '-2.3 '0 '1.5 '16 '1 '2000 '0.0025'0 '0 '0.1 '3 '0 '0.5 '0.01 '0.68 '0.93 )
$SET_PRESET(7'4 '0.1 '1 '2.39'1 '2.55'0.55 '35 '-2.3 '0 '1.5 '16 '1 '16 '0.1262'0 '0 '0.1 '3 '0 '0 '0.01 '1.00 '0 )
$SET_PRESET(8'1 '0 '0 '14.25'1 '6.97'0.55 '35 '-2.3 '0.13 '1.5 '4.78'1 '16 '0.0326'0 '1 '0.1 '3 '0 '0 '0.01 '0.6 '0 )
$SET_PRESET(9'1.65'0 '0 '1.7'1 '1.20'0.55 '100 '0 '0 '0 '3.8'0 '0 '0.001'0 '0 '0.1 '3 '0 '0.5 '0.01 '0.1 '0.55 )
$SET_PRESET(10'2' 0 '0 '1 '1 '2.15'0.55 '100 '0 '0.21 '12 '3.8'0 '0 '0.001'0 '0 '0.1 '3 '0 '0.5 '0.01 '0.35 '0.37 )
$SET_PRESET(11'2 '0.1 '1 '3.44'1 '3.75'0.55 '100 '0 '0.21 '25 '16 '0 '0 '0.001'1 '0 '0.1 '3 '0 '0.5 '0.05 '0 '0.37 )
$SET_PRESET(12'2 '0.1 '1 '1.45'1 '2.66'1.00 '16 '0 '0.21 '25 '16 '0 '0 '0.001'1 '0 '0.1 '3 '0 '0.5 '0.05 '0.6 '0.37 )
$SET_PRESET(13'1.9'0 '0 '24 '1 '2.29'1.00 '23.25 '-4 '1 '1.5 '16 '1 '151 '0.0178'1 '1 '0.1 '3 '0 '0.5 '0.01 '0.3 '0.55 )
endin

; The global effects receive audio from the global audio output bus,
; and send it on to their own global output busses.

gk_Reverb_Feedback init 0.975
gk_Reverb_DelayModulation init 0.875
instr Reverb
insno = p1
itime = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p7
ipan = p6
idepth = p8
iheight = p9
ipcs = p10
ihomogeneity = p11
ain_left chnget "out_left"
ain_right chnget "out_right"
azero init 0
aout_left init 0
aout_left, aright reverbsc ain_left, azero, gk_Reverb_Feedback, 15000.0
aleft init 0
azero init 0
aleft, aout_right reverbsc azero, ain_right, gk_Reverb_Feedback, 15000.0
chnmix aout_left, "reverb_out_left"
chnmix aout_right, "reverb_out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gk_MasterOutput_level init 0
instr MasterOutput
; Consume unused pfields.
insno = p1
itime = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p7
ipan = p6
idepth = p8
iheight = p9
ipcs = p10
ihomogeneity = p11
ain_left chnget "reverb_out_left"
ain_right chnget "reverb_out_right"
kgain = ampdb(gk_MasterOutput_level)
aout_left = ain_left * gk_MasterOutput_level * kgain * 0.00000001
aout_right = ain_right * gk_MasterOutput_level * kgain * 0.00000001
outs aout_left, aout_right
prints "instr %4d t %12.4f d %12.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

; This instrument clears the global output busses of audio for the next kperiod.

instr Clear
insno = p1
itime = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p7
ipan = p6
idepth = p8
iheight = p9
ipcs = p10
ihomogeneity = p11
chnclear "out_left"
chnclear "out_right"
chnclear "reverb_out_left"
chnclear "reverb_out_right"
prints "instr %4d t %12.4f d %12.4f\n", p1, p2, p3
endin

; Finally the orchestra itself turns on the effects instruments and the
; other always-on instruments.

scoreline_i "i \"Controls\" 0 -1"
scoreline_i "i \"FM_Clang_controls\" 0 -1"
scoreline_i "i \"FM_Clang_preset\" 0 -1"
scoreline_i "i \"Reverb\" 0 -1"
scoreline_i "i \"MasterOutput\" 0 -1"
scoreline_i "i \"Clear\" 0 -1"
    </textarea>
    <script type="text/javascript">
        /**
         * AUTHOR: Iacopo Sassarini
         * Based on Barry Martin's formula for the hopalong fractal.
         * Updated and adapted for music generation by Michael Gogins.
         */
        var score = new Silencio.Score();
        var FM9 = ChordSpace.chordForName('FM9');
        var Bb7 = ChordSpace.chordForName('Bb7');
        var chord = Bb7.clone();
        var modality = chord.clone();
        var RANGE = 60;
        var BASS = 36;
        var INSTRUMENT_COUNT = 10;
        var NOTE_COUNT = 16;
        var container = document.getElementById('webgl_cell');
        console.log('container:' + container);
        var velocity_cutoff = 150.;
        var VISUALS_VISIBLE = true;
        var SCALE_FACTOR = 1500;
        var CAMERA_BOUND = 200;
        var NUM_POINTS_SUBSET = 40000;
        var NUM_SUBSETS       = 6;
        var NUM_POINTS = NUM_POINTS_SUBSET * NUM_SUBSETS;
        var NUM_LEVELS = 5;
        var LEVEL_DEPTH = 400;
        var DEF_BRIGHTNESS = .5;
        var DEF_SATURATION = 0.8;
        var SPRITE_SIZE = Math.ceil(3 * container.clientWidth / 1600);
        // Orbit parameters constraints
        var A_MIN = -30;
        var A_MAX = 30;
        var B_MIN = .2;
        var B_MAX = 1.8;
        var C_MIN = 5;
        var C_MAX = 17;
        var D_MIN = 0;
        var D_MAX = 10;
        var E_MIN = 0;
        var E_MAX = 12;
        var note_count = 0;
        var Notes_per_second = 8;
        var current_time_seconds = new Date().getTime() / 1000.0;
        var start_time_seconds = current_time_seconds;
        var prior_time_seconds = current_time_seconds;
        var shuffled = false;
        var Starting_point = 0;///parseFloat(document.getElementById('Starting_point').value);
        var Stride = 10;//math.floor((NUM_POINTS_SUBSET / NOTE_COUNT) * NUM_SUBSETS);
        var Note_length = 1.0;
         // Orbit parameters
        var a, b, c, d, e;
        // Orbit data
        var orbit = {
            subsets: [],
            xMin: 0,
            xMax: 0,
            yMin: 0,
            yMax: 0,
            scaleX: 0,
            scaleY: 0
        }
        // Initialize data points
        for (var i = 0; i < NUM_SUBSETS; i++){
            var subsetPoints = [];
            for (var j = 0; j < NUM_POINTS_SUBSET; j++){
                subsetPoints[j] = {
                    x: 0,
                    y: 0,
                    vertex:  new THREE.Vector3(0,0,0)

                };
            }
            orbit.subsets.push(subsetPoints);
        }
        var camera, scene, renderer, composer, hueValues = [];
        var mouseX = 0, mouseY = 0;
        var windowHalfX = container.clientWidth / 2;
        var windowHalfY = container.clientHeight / 2;
        var Scene_speed = 2;///parseFloat(document.getElementById('Scene_speed').value);
        var rotationSpeed = 0;
        var randomization = 0;
        init();
        animate();
        function init() {
        // Use base64 encoded image to avoid cross-domain problems.
        var galaxy = new Image();
        galaxy.src = "data:image/png;base64,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";
        sprite1 = THREE.ImageUtils.loadTexture(galaxy.src);
            camera = new THREE.PerspectiveCamera(60, 1, 1, 3 * SCALE_FACTOR );
            camera.position.z = SCALE_FACTOR / 2;
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2( 0x000000, 0.0012);
            generateOrbit();
            for (var s = 0; s < NUM_SUBSETS; s++) {
                hueValues[s] = Math.random();
            }
            // Create particle systems
            for (var k = 0; k < NUM_LEVELS; k++){
                for (var s = 0; s < NUM_SUBSETS; s++){
                    var geometry = new THREE.Geometry();
                    for (var i = 0; i < NUM_POINTS_SUBSET; i++) {
                        geometry.vertices.push( orbit.subsets[s][i].vertex);
                    }
                    var materials = new THREE.PointsMaterial( { size: (SPRITE_SIZE ), map: sprite1, blending: THREE.AdditiveBlending, depthTest: false, transparent : true } );
                    materials.color.setHSL(hueValues[s], DEF_SATURATION, DEF_BRIGHTNESS);
                    var particles = new THREE.Points( geometry, materials );
                    particles.myMaterial = materials;
                    particles.myLevel = k;
                    particles.mySubset = s;
                    particles.position.x = 0;
                    particles.position.y = 0;
                    particles.position.z = - LEVEL_DEPTH * k - (s  * LEVEL_DEPTH / NUM_SUBSETS) + SCALE_FACTOR/2;
                    particles.needsUpdate = 0;
                    scene.add( particles );
                }
            }
            // Setup renderer and effects.
            renderer = new THREE.WebGLRenderer( { clearColor: 0x000000, clearAlpha: 1, antialias: false } );
            renderer.setSize( container.clientWidth, container.clientHeight );
            container.appendChild( renderer.domElement );
            window.addEventListener( 'resize', onWindowResize, false );
            // Schedule orbit regeneration
            setTimeout(updateOrbit, 10000 / Scene_speed);
            setTimeout(createNote, 1000 / Notes_per_second);
        }
        function animate() {
            requestAnimationFrame( animate );
            render();
        }
        function render() {
            if (camera.position.x >= - CAMERA_BOUND && camera.position.x <= CAMERA_BOUND){
                camera.position.x += ( mouseX - camera.position.x ) * 0.05;
                if (camera.position.x < - CAMERA_BOUND) camera.position.x = -CAMERA_BOUND;
                if (camera.position.x >  CAMERA_BOUND) camera.position.x = CAMERA_BOUND;
            }
            if (camera.position.y >= - CAMERA_BOUND && camera.position.y <= CAMERA_BOUND){
                camera.position.y += ( - mouseY - camera.position.y ) * 0.05;
                if (camera.position.y < - CAMERA_BOUND) camera.position.y = -CAMERA_BOUND;
                if (camera.position.y >  CAMERA_BOUND) camera.position.y = CAMERA_BOUND;
            }
            camera.lookAt( scene.position );
            for( i = 0; i < scene.children.length; i++ ) {
                scene.children[i].position.z +=  Scene_speed;
                scene.children[i].rotation.z += rotationSpeed * .1;
                if (scene.children[i].position.z > camera.position.z){
                    scene.children[i].position.z = - (NUM_LEVELS -1) * LEVEL_DEPTH;
                    if (scene.children[i].needsUpdate == 1){
                        scene.children[i].geometry.verticesNeedUpdate = true;
                        if (typeof scene.children[i].myMaterial !== 'undefined') {
                            scene.children[i].myMaterial.color.setHSL( hueValues[scene.children[i].mySubset], DEF_SATURATION, DEF_BRIGHTNESS);
                        }
                        scene.children[i].needsUpdate = 0;
                    }
                }
            }
            renderer.render(scene, camera);
            if (typeof csound !== 'undefined') {
                if (csound.is_playing === true) {
                    score_time_cell = document.getElementById('Time_cell');
                    current_time_seconds = new Date().getTime() / 1000.0;
                    var score_time = current_time_seconds - start_time_seconds;
                    score_time_cell.innerHTML = score_time.toFixed(3);
                 }
            }
        }
        ///////////////////////////////////////////////
        // Hopalong Orbit Generator
        ///////////////////////////////////////////////
        function updateOrbit(){
            generateOrbit();
            for (var s = 0; s < NUM_SUBSETS; s++){
                hueValues[s] = Math.random();
            }
            for( i = 0; i < scene.children.length; i++ ) {
                scene.children[i].needsUpdate = 1;
            }
            // Speed up or slow down the interval between generations.
            // Time is in milliseconds.
            setTimeout(updateOrbit, 10000 / Scene_speed);
         }
        function generateOrbit(){
            var x, y, z, x1;
            var idx = 0;
            prepareOrbit();
            // Using local vars should be faster
            var al = a;
            var bl = b;
            var cl = c;
            var dl = d;
            var el = e;
            var subsets = orbit.subsets;
            var num_points_subset_l = NUM_POINTS_SUBSET;
            var num_points_l = NUM_POINTS;
            var scale_factor_l = SCALE_FACTOR;
            var xMin = 0, xMax = 0, yMin = 0, yMax = 0;
            for (var s = 0; s < NUM_SUBSETS; s++){
                // Use a different starting point for each orbit subset
                x = s * .01 * (0.5 - randomization * Math.random());
                y = s * .01 * (0.5 - randomization * Math.random());
                var curSubset = subsets[s];
                for (var i = 0; i < num_points_subset_l; i++){
                    // Iteration formula (generalization of the Barry Martin's original one)
                    z = (dl + Math.sqrt(Math.abs(bl * x - cl)));
                    if (x > 0) {x1 = y - z;}
                    else if (x == 0) {x1 = y;}
                    else {x1 = y + z;}
                    y = al - x;
                    x = x1 + el;
                    curSubset[i].x = x;
                    curSubset[i].y = y;
                    if (x < xMin) {xMin = x;}
                    else if (x > xMax) {xMax = x;}
                    if (y < yMin) {yMin = y;}
                    else if (y > yMax) {yMax = y;}
                    idx++;
                }
            }
            var scaleX = 2 * scale_factor_l / (xMax - xMin);
            var scaleY = 2 * scale_factor_l / (yMax - yMin);
            orbit.xMin = xMin;
            orbit.xMax = xMax;
            orbit.yMin = yMin;
            orbit.yMax = yMax;
            orbit.scaleX = scaleX;
            orbit.scaleY = scaleY;
            console.log('Normalizing and updating vertices.')
            for (var s = 0; s < NUM_SUBSETS; s++){
              var curSubset = subsets[s];
              for (var i = 0; i < num_points_subset_l; i++){
                  curSubset[i].vertex.x = scaleX * (curSubset[i].x - xMin) - scale_factor_l;
                  curSubset[i].vertex.y = scaleY * (curSubset[i].y - yMin) - scale_factor_l;
              }
           }
        }
        function prepareOrbit(){
            console.log('prepareOrbit()...')
            if (shuffled == false) {
                shuffleParams();
                shuffled = true;
            }
            orbit.xMin = 0;
            orbit.xMax = 0;
            orbit.yMin = 0;
            orbit.yMax = 0;
        }
        function shuffleParams() {
            console.log('shuffleParams()...')
            a = A_MIN + Math.random() * (A_MAX - A_MIN);
            b = B_MIN + Math.random() * (B_MAX - B_MIN);
            c = C_MIN + Math.random() * (C_MAX - C_MIN);
            d = D_MIN + Math.random() * (D_MAX - D_MIN);
            e = E_MIN + Math.random() * (E_MAX - E_MIN);
        }
        function onDocumentTouchStart( event ) {
            if ( event.touches.length == 1 ) {
                event.preventDefault();
                mouseX = event.touches[ 0 ].pageX - windowHalfX;
                mouseY = event.touches[ 0 ].pageY - windowHalfY;
            }
        }
        function onDocumentTouchMove( event ) {
            if ( event.touches.length == 1 ) {
                event.preventDefault();
                mouseX = event.touches[ 0 ].pageX - windowHalfX;
                mouseY = event.touches[ 0 ].pageY - windowHalfY;
            }
        }
        function onWindowResize( event ) {
            var container = document.getElementById('webgl_cell');
            windowHalfX = container.clientWidth / 2;
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( container.clientWidth, container.clientHeight );
        }
        var mediaQueryList = window.matchMedia('print');
        mediaQueryList.addListener(function(mql) {
           console.log('mql: ' + mql.media);
           if (mql.matches) {
               console.log('onbeforeprint equivalent.');
           }
        });
        // Map orbit X to score instrument.
        function rescaleX(x) {
            var scale = orbit.xMax - orbit.xMin;
            x = x - orbit.xMin;
            x = x / scale;
            x = x * INSTRUMENT_COUNT;
            x = x + 1;
            return x;
        }
        // Map orbit Y to score pitch.
        function rescaleY(x) {
            var scale = orbit.yMax - orbit.yMin;
            x = x - orbit.yMin;
            x = x / scale;
            x = x * RANGE;
            x = x + BASS;
            return x;
        }
        function createNote() {
            var total_points_index = note_count * Stride;
            total_points_index = total_points_index % NUM_POINTS;
            var subset_index = Math.floor(total_points_index / NUM_POINTS_SUBSET);
            var subset_point_index = total_points_index - (subset_index * NUM_POINTS_SUBSET);
            var subset = orbit.subsets[subset_index];
            var point = subset[subset_point_index];
            var instrument = rescaleX(point.x);
            var key = rescaleY(point.y);
            var pan = Math.random() * 2 - 1;
            score.add(0, Note_length, 144, instrument, key, 60, pan, pan, 0, 0, 0);
            score.temper();
            ChordSpace.conformScoreToChord(score, chord, false);
            var score_text = score.toString();
            //var message = sprintf('createNote: subset: %2d point: %5d x: %9.4f y: %9.4f  %s', subset_index, subset_point_index, point.x, point.y, score_text);
            //console.log(message);
            // Protect against trying to call an undefined Csound.
            if (typeof csound != 'undefined') {
                if (csound.module !== null) {
                    if (csound.is_playing === true) {
                        score.sendToCsound(csound);
                        var Chord_cell = document.getElementById('Chord_cell');
                        Chord_cell.innerHTML = chord.name();
                        var Notes_cell = document.getElementById('Notes_cell');
                        Notes_cell.innerHTML = note_count;
                        var Subset_cell  = document.getElementById('Subset_cell');
                        Subset_cell.innerHTML = subset_index;
                        var Point_cell  = document.getElementById('Point_cell');
                        Point_cell.innerHTML = subset_point_index;
                        var X_cell  = document.getElementById('X_cell');
                        X_cell.innerHTML = sprintf("%011.4f", point.x);
                        var Y_cell  = document.getElementById('Y_cell');
                        Y_cell.innerHTML = sprintf("%011.4f", point.y);
                    }
                }
            }
            score.clear();
            note_count = note_count + 1;
            setTimeout(createNote, 1000 / Notes_per_second);
        }
        var parameters = {
            gk_Bower_pressure: 0.25,
            gk_Bower_level: 0.5,
            gk_Blower_grainDensity: .150,
            gk_Blower_grainDuration: .2,
            gk_Blower_grainAmplitudeRange: .1,
            gk_Blower_grainFrequencyRange: .033,
            gk_Blower_level: 0.5,
            gk_Buzzer_Harmonics: 15,
            gk_Buzzer_level: 0.5,
            gk_Droner_partial1: 0.1,
            gk_Droner_partial2: 0.1,
            gk_Droner_partial3: 0.1,
            gk_Droner_partial4: 0.1,
            gk_Droner_partial5: 0.1,
            gk_Droner_level: 0.5,
            gk_Harpsichord_level: 0.5,
            gk_Phaser_ratio1: 1,
            gk_Phaser_ratio2: .3333334,
            gk_Phaser_index1: 1,
            gk_Phaser_index2: .0125,
            gk_Phaser_level: 0.5,
            gk_Piano_level: 0.5,
            gk_Shiner_level: 0.5,
            gk_Sweeper_britel: 0,
            gk_Sweeper_briteh: 2.9,
            gk_Sweeper_britels: .2 / 3,
            gk_Sweeper_britehs: 2.5 / 2,
            gk_Sweeper_level: 0.5,
            gk_Reverb_Feedback: .975,
            gk_Reverb2_Feedback: .7,
            gk_MasterOutput_level: .4,
            gk_overlap: 0.05,
            gk_FM_Clang_preset: 1,
            gk_FM_Clang_level: 0,
            A: 1,
            B: 2,
            C: 2,
            D: 3,
            E: 4,
            Scene_randomization: 1,
            Scene_speed: 1,
            Camera_X: 0,
            Camera_Y: 0,
            Starting_point: 0,
            Note_length: 1,
            Notes_per_second: 8,
            Stride: 100,
            Play_Stop: function() {
                if (typeof csound.is_playing === 'undefined') {
                    csound.is_playing = false;
                }
                if (csound.is_playing === false) {
                    csound.perform();
                    gui.revert();
                    csound.compileOrc(document.getElementById('orc').value);
                    start_time_seconds = new Date().getTime() / 1000.0;
                    csound.is_playing = true;
                } else {
                    csound.is_playing = false;
                    csound.stop();
                }
            },
            FM9: function() {
                chord = FM9.clone();
                csound.message('FM9:\n' + chord.information());
            },
            Bb7: function() {
                chord = Bb7.clone();
                csound.message('Bb7:\n' + chord.information());
            },
            K: function() {
                chord = chord.K();
                csound.message('K():\n' + chord.information());
            },
            Q2: function() {
                chord = chord.Q(2, modality);
                csound.message('Q(2, modality):\n' + chord.information());
            },
            Q3: function() {
                chord = chord.Q(3, modality);
                csound.message('Q(3, modality):\n' + chord.information());
            },
            Q5: function() {
                chord = chord.Q(5, modality);
                csound.message('Q(5, modality):\n' + chord.information());
            },
            J2_2: function() {
                var chords = chord.J(2);
                if (chords.length > 1) {
                    chord = chords[1];
                    csound.message('J(2,2):\n' + chord.information());
                }
            },
            J2_3: function() {
                var chords = chord.J(2);
                if (chords.length > 2) {
                    chord = chords[2];
                    csound.message('J(2,3):\n' + chord.information());
                }
            },
            J3_1: function() {
               var chords = chord.J(3);
                if (chords.length > 0) {
                    chord = chords[0];
                    csound.message('J(3,1):\n' + chord.information());
                }
            },
            T5: function() {
                chord = chord.T(5);
                csound.message('D():\n' + chord.information());
            },
        };

        var gui = null;
        window.onload = function() {
            csound.message('platform: ' + navigator.platform + '\n');
            gui = new dat.GUI({width: 300});
            gui.remember(parameters);
            var intruments = gui.addFolder('Csound instruments');
            var fmclang = intruments.addFolder('FM Clang');
            add_slider(fmclang, 'gk_FM_Clang_preset', 1, 13);
            add_slider(fmclang, 'gk_FM_Clang_level', -40, 40);
            var Blower = intruments.addFolder('Blower');
            add_slider(Blower, 'gk_Blower_grainDensity', 0, 400);
            add_slider(Blower, 'gk_Blower_grainDuration', 0, .5);
            add_slider(Blower, 'gk_Blower_grainAmplitudeRange', 0, 400);
            add_slider(Blower, 'gk_Blower_grainFrequencyRange', 0, 100);
            add_slider(Blower, 'gk_Blower_level', -40, 40);
            var Bower = intruments.addFolder('Bower');
            add_slider(Bower, 'gk_Bower_pressure', 0, 1);
            add_slider(Bower, 'gk_Bower_level', -40, 40);
            var Buzzer = intruments.addFolder('Buzzer');
            add_slider(Buzzer, 'gk_Buzzer_Harmonics', 0, 20);
            add_slider(Buzzer, 'gk_Buzzer_level', -40, 40);
            var Droner = intruments.addFolder('Droner');
            add_slider(Droner, 'gk_Droner_partial1', 0, 1);
            add_slider(Droner, 'gk_Droner_partial2', 0, 1);
            add_slider(Droner, 'gk_Droner_partial3', 0, 1);
            add_slider(Droner, 'gk_Droner_partial4', 0, 1);
            add_slider(Droner, 'gk_Droner_partial5', 0, 1);
            add_slider(Droner, 'gk_Droner_level', -40, 40);
            var Harpsichord = intruments.addFolder('Harpsichord');
            add_slider(Harpsichord, 'gk_Harpsichord_level', -40, 40);
            var Phaser = intruments.addFolder('Phaser');
            add_slider(Phaser, 'gk_Phaser_ratio1', 0, 2);
            add_slider(Phaser, 'gk_Phaser_ratio2', 0, 2);
            add_slider(Phaser, 'gk_Phaser_index1', 0, 1);
            add_slider(Phaser, 'gk_Phaser_index2', 0, 1);
            add_slider(Phaser, 'gk_Phaser_level', -40, 40);
            var Pianoteq = intruments.addFolder('Pianoteq');
            add_slider(Pianoteq, 'gk_Piano_level', -40, 40);
            var Shiner = intruments.addFolder('Shiner');
            add_slider(Shiner, 'gk_Shiner_level', -40, 40);
            var Sweeper = intruments.addFolder('Sweeper');
            add_slider(Sweeper, 'gk_Sweeper_britel', 0, 4);
            add_slider(Sweeper, 'gk_Sweeper_briteh', 0, 4);
            add_slider(Sweeper, 'gk_Sweeper_britels', 0, 4);
            add_slider(Sweeper, 'gk_Sweeper_britehs', 0, 4);
            add_slider(Sweeper, 'gk_Sweeper_level', -40, 40);
            add_slider(Sweeper, 'gk_Sweeper_level', -40, 40);
            var Master = gui.addFolder('Master effects');
            add_slider(Master, 'gk_overlap', 0, 20);
            add_slider(Master, 'gk_Reverb_Feedback', 0, 1);
            add_slider(Master, 'gk_Reverb2_Feedback', 0, 1);
            add_slider(Master, 'gk_MasterOutput_level', -40, 40);
            var Hopalong = gui.addFolder('Hopalong fractal');
            add_slider(Hopalong, 'A', -30, 30);
            add_slider(Hopalong, 'B', .2, 1.8);
            add_slider(Hopalong, 'C', 5, 17);
            add_slider(Hopalong, 'D', 0, 10);
            add_slider(Hopalong, 'E', 5, 12);
            var Chords = gui.addFolder('Chords and transformations')
            Chords.add(parameters, 'Bb7');
            Chords.add(parameters, 'FM9');
            Chords.add(parameters, 'K').name('K()');
            Chords.add(parameters, 'Q2').name('Q(2)');
            Chords.add(parameters, 'Q3').name('Q(3)');
            Chords.add(parameters, 'Q5').name('Q(5)');
            Chords.add(parameters, 'J2_2').name('J(2,2)');
            Chords.add(parameters, 'J2_3').name('J(2,3)');
            Chords.add(parameters, 'J3_1').name('J(3,1)');
            Chords.add(parameters, 'T5').name('D()');
            var Generate = gui.addFolder('Note generation')
            add_slider(Generate, 'Scene_speed', .5, 20).name('Scene speed');
            add_slider(Generate, 'Scene_randomization', 0, 1).name('Scene randomization');
            add_slider(Generate, 'Starting_point', 0, 39999).name('Starting index');
            add_slider(Generate, 'Stride', 1, 40000);
            add_slider(Generate, 'Note_length', 0.104167, 8).name('Note duration');
            add_slider(Generate, 'Notes_per_second', 0.25, 32).name('Notes per second');
            add_slider(Generate, 'Camera_X', -500, 500).name('Camera X');
            add_slider(Generate, 'Camera_Y', -500, 500).name('Camera Y');
            gui.add(parameters, 'Play_Stop').name('Play/Stop');
            gui.revert();
        }
        function gk_update(name, value) {
            if (typeof csound !== 'undefined') {
                var numberValue = parseFloat(value);
                csound.setControlChannel(name, numberValue);
                csound.message(name + ': ' + numberValue + '\n');
            }
        }
        function add_slider(gui_folder, token, minimum, maximum) {
            var on_parameter_change = function(value) {
                if (token.startsWith('gk_')) {
                    gk_update(token, value);
                } else if (token === 'Scene_speed') {
                    Scene_speed = value;
                } else if (token === 'Scene_randomization') {
                    randomization = value;
                } else if (token === 'Camera_X') {
                    mouseX = value;
                } else if (token === 'Camera_Y') {
                    mouseY = value;
                } else if (token === 'A') {
                    a = value;
                } else if (token === 'B') {
                    b = value;
                } else if (token === 'C') {
                    c = value;
                } else if (token === 'D') {
                    d = value;
                } else if (token === 'E') {
                    e = value;
                } else if (token === 'Starting_point') {
                    Starting_point = Math.floor(value);
                } else if (token === 'Stride') {
                    Stride = Math.floor(value);
                } else if (token === 'Notes_per_second') {
                    Notes_per_second = value;
                }
            };
            var slider = gui_folder.add(parameters, token, minimum, maximum);
            slider.onChange(on_parameter_change);
            return slider;
        };
        if (typeof csound !== 'undefined') {
            csound.is_playing = false;
        }
       </script>
    <script>
    // Messages both from the "csound.js" wrapper and from Csound itself are combined in the
    // "console" text area.
    function handleMessage(message) {
        console.log(message);
        var messages_textarea = document.getElementById("console");
        var existing = messages_textarea.value;
        messages_textarea.value = existing + message.data;
        messages_textarea.scrollTop = messages_textarea.scrollHeight;
    }
    </script>
    <!--The PNaCl csound module must be the very last element in the body,
        because the "csound.js" script attaches the Csound module and its
        callbacks to that element. -->
    <script type="text/javascript" src="csound.js"></script>
    <div id="engine"></div>
    </body>
</html>
